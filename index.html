<script>
  AFRAME.registerComponent('draggable', {
    schema: {
      speed: {type: 'number', default: 0.5}
    },
    init: function() {
      this.ifMouseDown = false;
      this.x_cord = 0;
      this.y_cord = 0;
      this.handleMouseDown = this.handleMouseDown.bind(this);
      this.handleMouseUp = this.handleMouseUp.bind(this);
      this.handleMouseMove = this.handleMouseMove.bind(this);
      this.handleTouchStart = this.handleTouchStart.bind(this);
      this.handleTouchMove = this.handleTouchMove.bind(this);
      this.handleTouchEnd = this.handleTouchEnd.bind(this);

      this.el.addEventListener('mousedown', this.handleMouseDown);
      window.addEventListener('mouseup', this.handleMouseUp);
      this.el.addEventListener('mousemove', this.handleMouseMove);
      this.el.sceneEl.canvas.addEventListener('touchstart', this.handleTouchStart, false);
      this.el.sceneEl.canvas.addEventListener('touchmove', this.handleTouchMove, false);
      this.el.sceneEl.canvas.addEventListener('touchend', this.handleTouchEnd, false);
    },
    remove: function() {
      this.el.removeEventListener('mousedown', this.handleMouseDown);
      window.removeEventListener('mouseup', this.handleMouseUp);
      this.el.removeEventListener('mousemove', this.handleMouseMove);
      this.el.sceneEl.canvas.removeEventListener('touchstart', this.handleTouchStart);
      this.el.sceneEl.canvas.removeEventListener('touchmove', this.handleTouchMove);
      this.el.sceneEl.canvas.removeEventListener('touchend', this.handleTouchEnd);
    },
    handleMouseDown: function(event) {
      this.ifMouseDown = true;
      this.x_cord = event.clientX;
      this.y_cord = event.clientY;
      this.shiftKey = event.shiftKey;
      this.ctrlKey = event.ctrlKey;
    },
    handleMouseUp: function() {
      this.ifMouseDown = false;
    },
    handleMouseMove: function(event) {
      if (this.ifMouseDown) {
        var deltaX = event.clientX - this.x_cord;
        var deltaY = event.clientY - this.y_cord;
        this.x_cord = event.clientX;
        this.y_cord = event.clientY;
        var position = this.el.getAttribute('position');
        var rotation = this.el.getAttribute('rotation');

        if (this.shiftKey) {
          // Move object along X and Z axis
          position.x += deltaX * this.data.speed * 0.1;
          position.z -= deltaY * this.data.speed * 0.1;
          this.el.setAttribute('position', position);
        } else if (this.ctrlKey) {
          // Move object along Y axis
          position.y += deltaY * this.data.speed * 0.1;
          this.el.setAttribute('position', position);
        } else {
          // Rotate object
          rotation.y += deltaX * this.data.speed;
          rotation.x -= deltaY * this.data.speed;
          this.el.setAttribute('rotation', rotation);
        }
      }
    },
    handleTouchStart: function(event) {
      this.ifMouseDown = true;
      this.x_cord = event.touches[0].clientX;
      this.y_cord = event.touches[0].clientY;
      event.preventDefault();
    },
    handleTouchMove: function(event) {
      if (this.ifMouseDown) {
        var deltaX = event.touches[0].clientX - this.x_cord;
        var deltaY = event.touches[0].clientY - this.y_cord;
        this.x_cord = event.touches[0].clientX;
        this.y_cord = event.touches[0].clientY;
        var position = this.el.getAttribute('position');
        var rotation = this.el.getAttribute('rotation');

        // Assume default touch is for movement
        position.x += deltaX * this.data.speed * 0.1;
        position.z -= deltaY * this.data.speed * 0.1;
        this.el.setAttribute('position', position);

        event.preventDefault();
      }
    },
    handleTouchEnd: function() {
      this.ifMouseDown = false;
    }
  });
</script>
