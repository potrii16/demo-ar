<script>
  AFRAME.registerComponent('touch-control', {
    schema: {
      speed: {type: 'number', default: 5},
      minScale: {type: 'number', default: 0.5},
      maxScale: {type: 'number', default: 2}
    },
    init: function() {
      this.startDistance = 0;
      this.startScale = 1;
      this.el.sceneEl.addEventListener('touchstart', this.handleTouchStart.bind(this), {passive: false});
      this.el.sceneEl.addEventListener('touchmove', this.handleTouchMove.bind(this), {passive: false});
      this.el.sceneEl.addEventListener('touchend', this.handleTouchEnd.bind(this));
    },
    handleTouchStart: function(event) {
      if (event.touches.length === 2) {
        // Initialize touch positions and calculate initial distance
        const touch1 = event.touches[0];
        const touch2 = event.touches[1];
        this.startDistance = this.calculateDistance(touch1, touch2);
        this.startScale = this.el.getAttribute('scale').x;
      }
    },
    handleTouchMove: function(event) {
      if (event.touches.length === 2) {
        const touch1 = event.touches[0];
        const touch2 = event.touches[1];
        const currentDistance = this.calculateDistance(touch1, touch2);
        const scaleRatio = currentDistance / this.startDistance;
        const newScale = this.startScale * scaleRatio;
        const clampedScale = Math.max(this.data.minScale, Math.min(this.data.maxScale, newScale));
        this.el.setAttribute('scale', {x: clampedScale, y: clampedScale, z: clampedScale});
        event.preventDefault();
      }
    },
    handleTouchEnd: function() {
      // Reset start distance and scale when touches end
      this.startDistance = 0;
      this.startScale = 1;
    },
    calculateDistance: function(touch1, touch2) {
      const dx = touch2.clientX - touch1.clientX;
      const dy = touch2.clientY - touch1.clientY;
      return Math.sqrt(dx * dx + dy * dy);
    }
  });
</script>
