<!doctype HTML>
<html>
<head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent('draggable', {
        schema: {
          speed: {default: 1}
        },
        init: function () {
          this.ifMouseDown = false;
          this.x_cord = 0;
          this.y_cord = 0;
          this.addEventListener('mousedown', (event) => {
            this.ifMouseDown = true;
            this.x_cord = event.clientX;
            this.y_cord = event.clientY;
          });
          this.addEventListener('mouseup', () => {
            this.ifMouseDown = false;
          });
          this.addEventListener('mousemove', (event) => {
            if (this.ifMouseDown) {
              var temp_x = event.clientX-this.x_cord;
              var temp_y = event.clientY-this.y_cord;
              this.x_cord = event.clientX;
              this.y_cord = event.clientY;
              var rotation = this.el.getAttribute('rotation');
              rotation.y += temp_x * this.data.speed;
              rotation.x -= temp_y * this.data.speed;
              this.el.setAttribute('rotation', rotation);
            }
          });
          // Add touch events for mobile
          this.el.sceneEl.canvas.addEventListener('touchstart', (event) => {
            this.ifMouseDown = true;
            this.x_cord = event.touches[0].clientX;
            this.y_cord = event.touches[0].clientY;
          }, false);
          this.el.sceneEl.canvas.addEventListener('touchend', () => {
            this.ifMouseDown = false;
          }, false);
          this.el.sceneEl.canvas.addEventListener('touchmove', (event) => {
            if (this.ifMouseDown) {
              var temp_x = event.touches[0].clientX - this.x_cord;
              var temp_y = event.touches[0].clientY - this.y_cord;
              this.x_cord = event.touches[0].clientX;
              this.y_cord = event.touches[0].clientY;
              var rotation = this.el.getAttribute('rotation');
              rotation.y += temp_x * this.data.speed;
              rotation.x -= temp_y * this.data.speed;
              this.el.setAttribute('rotation', rotation);
            }
          }, false);
        }
      });
    </script>
</head>
<body style='margin : 0px; overflow: hidden;'>
<a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
    <a-marker preset='custom' url='pattern.patt'>
        <a-box position='0 0.5 0' material='color: green; opacity: 0.5'></a-box>
    </a-marker>
    <a-marker preset='hiro'>
        <a-box position="0 0.5 0" material="color: red; opacity: 0.5" draggable="speed: 0.5"></a-box>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>
</body>
</html>
