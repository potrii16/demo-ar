<!doctype HTML>
<html>
<head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent('touch-control', {
        schema: {
          speed: {type: 'number', default: 5},
          minScale: {type: 'number', default: 0.5},
          maxScale: {type: 'number', default: 2}
        },
        init: function() {
          this.startTouchPositions = [];
          this.startRotation = null;
          this.startScale = 1;
          this.el.sceneEl.addEventListener('touchstart', this.handleTouchStart.bind(this), {passive: false});
          this.el.sceneEl.addEventListener('touchmove', this.handleTouchMove.bind(this), {passive: false});
          this.el.sceneEl.addEventListener('touchend', this.handleTouchEnd.bind(this));
        },
        handleTouchStart: function(event) {
          // Capture the start positions of the touch points
          this.startTouchPositions = Array.from(event.touches).map(touch => ({x: touch.clientX, y: touch.clientY}));
          if (event.touches.length === 1) {
            this.startRotation = this.el.getAttribute('rotation');
          } else if (event.touches.length === 2) {
            this.startScale = this.el.getAttribute('scale').x; // Assuming uniform scaling
          }
        },
        handleTouchMove: function(event) {
          if (event.touches.length === 1 && this.startTouchPositions.length === 1) {
            // Handle rotation
            const deltaX = event.touches[0].clientX - this.startTouchPositions[0].x;
            const deltaY = event.touches[0].clientY - this.startTouchPositions[0].y;
            const newRotation = {
              x: this.startRotation.x - deltaY * this.data.speed * 0.1,
              y: this.startRotation.y + deltaX * this.data.speed * 0.1,
              z: this.startRotation.z
            };
            this.el.setAttribute('rotation', newRotation);
          } else if (event.touches.length === 2 && this.startTouchPositions.length === 2) {
            // Handle scaling
            const startDistance = Math.hypot(
              this.startTouchPositions[0].x - this.startTouchPositions[1].x,
              this.startTouchPositions[0].y - this.startTouchPositions[1].y
            );
            const currentDistance = Math.hypot(
              event.touches[0].clientX - event.touches[1].clientX,
              event.touches[0].clientY - event.touches[1].clientY
            );
            const scale = this.startScale * (currentDistance / startDistance);
            const clampedScale = Math.max(this.data.minScale, Math.min(this.data.maxScale, scale));
            this.el.setAttribute('scale', {x: clampedScale, y: clampedScale, z: clampedScale});
          }
          event.preventDefault();
        },
        handleTouchEnd: function() {
          this.startTouchPositions = [];
        }
      });
    </script>
</head>
<body style='margin: 0; overflow: hidden;'>
<a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
    <a-marker preset='hiro'>
        <a-box position="0 0.5 0" rotation="0 0 0" material="color: red; opacity: 0.5" touch-control>
            <!-- Small white square on the top of the red cube -->
            <a-box position="0 0.55 0" rotation="0 0 0" material="color: white; opacity: 1" scale="0.2 0.2 0.2" detect-click></a-box>
        </a-box>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>
</body>
</html>
